---
title: "2017 Jim Holland Summer Project"
author: "Ken Locey"
date: "July 12, 2017"
output: pdf_document
---

```{r}
# Retrieve and set the working directory
rm(list=ls())
getwd()
setwd("~/GitHub/DistDecay/analyses/DistanceDecay")

# Load Soil Data
dat <- read.table("~/GitHub/SSRP_2017/colonydata.txt", sep = ",", header = TRUE)

soil.dat <- dat[dat$Type == 'soil', ]
skin.dat <- dat[dat$Type == 'skin', ]
```


```{r}
# Assign columns in data.frame to objects
# Calculate CFU's from colonies
rpf <- log2(soil.dat$Concentration + 1)
col.num <- soil.dat$Colonies
dil.factor <- soil.dat$Dilutions
cfu <- (col.num/0.1)/dil.factor # Calculate CFU from colony number
m.types <- soil.dat$Morphotypes
```


## Plot number of colony forming units (CFUs) 
```{r}
plot.new()
par(mfrow=c(1, 1), mar = c(5,5,3,1), oma =c(0,0,2,0))

plot(rpf, cfu, main="Number of colonies vs Rpf", 
  	xlab="Rpf concentration, log2(umol/L)", ylab="CFU", pch=19)

# Add fit lines
lm.fit <- lm(cfu ~ rpf + I(rpf^2))
dat2 <- data.frame(cbind('rpf'=rpf, 'cfu'=predict(lm.fit)))
dat2 <- dat2[order(dat2), ]

r2 <- summary(lm.fit)$r.squared
coefs <- summary(lm.fit)$coefficients
summary(lm.fit)

# predicts + interval
newx <- seq(min(rpf), max(rpf), length.out=30)
preds <- predict(lm.fit, interval = 'confidence')

clr <- 'gray' #c(2,2,3,4,5) 
clr <- adjustcolor(clr, alpha.f = 0.3) 
polygon(c(rev(newx), newx), c(rev(preds[ ,3]), preds[ ,2]), col = clr, border = NA)

lines(dat2$rpf, dat2$cfu, col="red", lwd=2) # regression line (y~x) 
lines(lowess(rpf, cfu), col="blue", lwd=2) # lowess line (x,y)
points(rpf, cfu, pch=19)
```


## Plot morphotypes 
```{r}
plot.new()
plot(rpf, m.types, main="Morphotypes vs Rpf", 
  	xlab="Rpf concentration, log2(umol/L)", ylab="Number of morphotypes", pch=19)

lm.fit <- lm(m.types ~ rpf, dat)
dat2 <- data.frame(cbind('rpf'=rpf, 'mtype'=predict(lm.fit)))
dat2 <- dat2[order(dat2), ]  

r2 <- summary(lm.fit)$r.squared
coefs <- summary(lm.fit)$coefficients
#summary(lm.fit)

# predicts + interval
newx <- seq(min(dat2$rpf), max(dat2$rpf), len=100)
preds <- predict(lm.fit, newdata=data.frame(x=newx),interval = c("confidence"), level = 0.95, type="response") 

clr <- 'gray' #c(2,2,3,4,5) 
clr <- adjustcolor(clr, alpha.f = 0.3) 
polygon(c(rev(newx), newx), c(rev(preds[ ,3]), preds[ ,2]), col = clr, border = NA)

lines(dat2$rpf, dat2$y, col="red", lwd=2) # regression line (y~x) 
lines(lowess(rpf, m.types), col="blue", lwd=2) # lowess line (x,y)
points(rpf, m.types, pch=19)
```

# Skin Data
## Two-tailed T-test for di
```{r}
soil.dat <- soil.dat[soil.dat$Concentration > 0, ]
soil.dat <- soil.dat[soil.dat$Concentration < 1.7, ]

rpf <- log2(soil.dat$Concentration + 1)
col.num <- soil.dat$Colonies
dil.factor <- soil.dat$Dilutions
cfu <- (col.num/0.1)/dil.factor # Calculate CFU from colony number
soil.cfu <- log2(cfu)

skin.rpf <- log2(skin.dat$Concentration + 1)
skin.col.num <- skin.dat$Colonies
dil.factor <- skin.dat$Dilutions
skin.cfu <- (skin.col.num/0.1)/dil.factor # Calculate CFU from colony number
skin.cfu <- log2(skin.cfu)

t.test(skin.cfu, soil.cfu)

avg.skin <- mean(skin.cfu)
avg.soil <- mean(soil.cfu)
```